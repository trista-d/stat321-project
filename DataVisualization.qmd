---
title: "Data Visualization Final Project"
author: "Karen Nickel"
format: html
editor: visual
---

## Data Visualization Comments/Criteria

8\. Can we use R packages like ggplot2 or plotly for visualization?\
➢ Yes! You are free to use any R packages we discussed in class. Just make sure you\
cite the package in the references.

\
9. How many visualizations are required?\
➢ There is no fixed number, but you should create at least 3-5 visualizations that help\
explain your dataset and analysis.

\
10. Do we need interactive visualizations?\
➢ Interactive visualizations are optional, but they can enhance your project and\
improve your presentation score.

## Import and Read Dataset - must redo for the final cleaned version

```{r}
library(readr)
cleaned_nfl_data <- read_csv("final_clean_nfl.csv")
View(cleaned_nfl_data)
```

## Visualizations: Performance vs. Salary

Big plays: Touchdowns vs. Salary

-   scatter for all

-   bar chart for top 10 and bottom 10

Consistency: Yards vs. Salary

-   scatter for all

-   bar chart for top 10 and bottom 10

**Plot 1: Histogram: Salary distribution among receivers.**

**Plots 2 and 3: If yards by salary more important for scatter, do bar chart for the touchdowns.**

-   **do one or the other; one of each.**

Plot 4: Heat map (use tableau). because everything should connect back to salary.

-   this will use catch rate in it, and the 20-39 and 40+ columns, compared to salary as the colours.

Plot 5: Dashboard to support conclusions. So and so was the best of the season.

-   will pull the top plays from youtube and link them.

-   This will be a table with highlighted stuff and plays attached.

-   Will decide which players to put in the table/dashboard in based on figure results/regression results.

#### Setup:

##### Importing final cleaned data under name "final_clean_nfl".

```{r}
library(readr)
final_clean_nfl <- read_csv("final_clean_nfl.csv")
View(final_clean_nfl)
```

#### Plot 1: histogram of Salary

##### UI:

```{r}
library(ggplot2)

ui_salary <- fluidPage(
  titlePanel("Salary Histogram"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("bins",
                  "Number of Bins:",
                  min= 5,
                  max= 50,
                  value= 10) #Default is 10bins

      ),
    mainPanel(
      plotOutput("histPlot") #Output placeholder for the histogram
      ) 
    )
  )
```

##### Server:

```{r}
server_salary <- function(input,output){
  output$histPlot <- renderPlot({      # use the Salary data from dataset
    salary_data <- final_clean_nfl$Salary
 #Create the histogram with user-defined bins
 ggplot(data = data.frame(x = salary_data), aes(x = final_clean_nfl$Salary)) +
   geom_histogram(bins = input$bins, fill = '#009E73', color = "white") + 
   # green for $$
  theme_minimal() +
   labs(
     title = "Histogram of NFL Receiver 2024 Salaries",
     x = "Salary ($)",
     y = "Frequency"
     )
  })
}
```

##### Running the app:

```{r, eval = FALSE}
shinyApp(ui = ui_salary, server = server_salary)
```

From the histogram, we can see that the 2024 salaries of NFL recievers is heavily right skewed, with several extreme outliers with very high salaries.

The untransformed salaries were plotted on the x axis in order to accurately visualize just how much higher the outlier salaries are, since plotting the log10 or square root transformed salaries may distort our understanding of the data.

#### Log transformation version:

##### UI:

```{r}
library(ggplot2)
library(shiny)

final_clean_nfl$logSalary <- log(final_clean_nfl$Salary)

ui_salary <- fluidPage(
  titlePanel("Salary Histogram"),
  sidebarLayout(
    sidebarPanel(
      sliderInput("bins",
                  "Number of Bins:",
                  min= 5,
                  max= 50,
                  value= 10) #Default is 10bins

      ),
    mainPanel(
      plotOutput("histPlot") #Output placeholder for the histogram
      ) 
    )
  )
```

##### Server:

```{r}
server_salary <- function(input,output){
  output$histPlot <- renderPlot({      # use the Salary data from dataset
    salary_data <- (final_clean_nfl$logSalary)
 #Create the histogram with user-defined bins
 ggplot(data = data.frame(x = salary_data), aes(x = x)) +
   geom_histogram(bins = input$bins, fill = '#009E73', color = "white") +
  theme_minimal() +
   labs(
     title = "Histogram of NFL Receiver 2024 log-transformed Salaries",
     x = "log(Salary ($))",
     y = "Frequency"
     )
  })
}
```

##### Running the app:

```{r}
shinyApp(ui = ui_salary, server = server_salary)
```

Because there is such a large range of salaries, we decided to use a log transformation on the salaries to minimize the impact of very high salaries. The log transformed salaries were used throughout the the data visualization.

#### Plot 2: Scatter plots of Salary as as function of Touchdowns or Yards - Will use TD.

##### Salary as a function of Touchdowns: 

Used this site <https://stackoverflow.com/questions/15624656/label-points-in-geom-point> to add labels to specific points on the plot.

```{r}

ggplot(final_clean_nfl, aes(x = TD, y = logSalary)) +
  geom_point(size = 3, color = '#D55E00') +   # size is for size of the points
  labs(title = "logSalary vs. Touchdowns",
       x = "Number of Touchdowns",
       y = "log(2024 Salary ($))") +
  ylim(13, 17.5) +
  # add a verticle line at the median TD
  geom_vline(xintercept = median(final_clean_nfl$TD), color = "grey") +
  theme_minimal() +
  # label the players with highest salaries and highest number of touchdowns
  geom_text(label = ifelse(final_clean_nfl$Salary > 12500000 & final_clean_nfl$Salary != 18100000, final_clean_nfl$Player, ''), vjust = 1.4) +
  geom_text(label = ifelse(final_clean_nfl$Salary == 18100000, final_clean_nfl$Player, ''), vjust = -0.8) +
  geom_text(label = ifelse(final_clean_nfl$TD > 15, final_clean_nfl$Player, ''), hjust = 0.7, vjust = -1) +
  geom_text(label = ifelse(final_clean_nfl$TD > 11 & final_clean_nfl$TD < 13, final_clean_nfl$Player, ''), vjust = -1) +
  annotate("text", label = "Median TD", x = median(final_clean_nfl$TD), y = 17.5, color = "grey")


geom_vline()
```

There is no obvious trend between the total touchdowns made and a player's salary in 2024. However, it does appear that the players receiving the highest salaries are making more than the median number of touchdowns. That being said, the players making some of the highest numbers of touchdowns are not receiving very high salaries.

The median was represented rather than the mean because the TD variable is skewed and has outliers.

##### Salary as a function of Yards: will not be using

Used this site <https://stackoverflow.com/questions/15624656/label-points-in-geom-point> to add labels to specific points on the plot.

```{r}
ggplot(final_clean_nfl, aes(x = Yds, y = logSalary)) +
  geom_point(size = 3, color = '#56B4E9') +
  labs(title = "log(Salary) vs. Yards",
       x = "Yards travelled with ball",
       y = "log(2024 Salary ($))") +
  ylim(13, 17.5) +
  # add a vertical line at the median Yds
  geom_vline(xintercept = median(final_clean_nfl$Yds), color = "grey") +
  theme_minimal() +
  # highlight some of the highest salaries and some of the highest yards travelled
  geom_text(label = ifelse(final_clean_nfl$Salary > 12500000 & final_clean_nfl$Salary != 18100000, final_clean_nfl$Player, ''), vjust = 1.4) +
  geom_text(label = ifelse(final_clean_nfl$Salary == 18100000, final_clean_nfl$Player, ''), vjust = -0.8) +
  geom_text(label = ifelse(final_clean_nfl$Yds > 1600, final_clean_nfl$Player, ''), hjust = 0.7, vjust = 1.2) +
  geom_text(label = ifelse(final_clean_nfl$Yds > 1500 & final_clean_nfl$Yds < 1600, final_clean_nfl$Player, ''), vjust = -1) + 
  annotate("text", label = "Median Yards", x = (median(final_clean_nfl$Yds) - 10), y = 17.5, color = "grey")
```

There is no clear trend between the yards travelled with the ball and a player's salary in 2024. Some of the players receiving the highest salaries are travelling more than the median number of yards, but some are very close to or below the median. That being said, the players travelling some of the greatest distances are not receiving very high salaries.

The two players who travelled the greatest number of yards with the ball did not have very high salaries, and the players receiving the highest salaries were usually above the median yards travelled, with one exception, but were still not travelling particularly exceptional distances.

The median was represented rather than the mean because the yards variable is skewed and appears to have outliers.

#### Plot 3: Bar charts of Salary for top and bottom 10 touchdowns and yards.

##### Touchdowns: 

NOTE: I think we should use the normal Salary variable here, not the log-transformed one, because the barplots are for seeing the highest/lowest in groups and I think that having log-transformed data distorts our view of that.

```{r}
# sorting the dataset by the number of touchdowns. 
library(dplyr)
sorted_TD_nfl <- final_clean_nfl %>%
  arrange(desc(TD))

# creating new datasets of the top and bottom 10 number of touchdowns. 
bottom10_TD_nfl <- tail(sorted_TD_nfl, 10)
top10_TD_nfl <- head(sorted_TD_nfl, 10)

# plotting bar chart of salaries for the players who made the 10 least touchdowns. 
ggplot(bottom10_TD_nfl, aes(x = factor(Player), y = Salary)) +
  geom_bar(stat = "identity", fill = '#D55E00') +
  labs(title = "Average 2024 Salary of Players with 10 Fewest Touchdowns", x = "Players with 10 Fewest Touchdowns", y = "2024 Salary ($)") + 
  theme_minimal() +
  # making the player names angled so they fit
  theme(axis.text.x = element_text(angle=45, vjust=1.07, hjust=1)) +
  geom_text(label = bottom10_TD_nfl$TD, vjust = 1)

# and 10 most touchdowns. 
ggplot(top10_TD_nfl, aes(x = factor(Player), y = Salary)) +
  geom_bar(stat = "identity", fill = '#D55E00') +
  labs(title = "Average 2024 Salary of Players with 10 Most Touchdowns", x = "Players with 10 Most Touchdowns", y = "2024 Salary ($)") + 
  theme_minimal() +
  ylim(0, 25000000) +
  # making the player names angled so they fit
  theme(axis.text.x = element_text(angle=45, vjust=1.07, hjust=1)) +
  geom_text(label = top10_TD_nfl$TD, vjust = -0.5)
```

NOTE: not really sure how useful these graphs are, because we don't really get much from touchdowns for this, because they are whole numbers so multiple people have the same number so we don't really get much.

##### Yards:

```{r}
# sorting the dataset by the number of touchdowns. 
library(dplyr)
sorted_Yds_nfl <- final_clean_nfl %>%
  arrange(desc(Yds))

# creating new datasets of the top and bottom 10 number of touchdowns. 
bottom10_Yds_nfl <- tail(sorted_Yds_nfl, 10)
top10_Yds_nfl <- head(sorted_Yds_nfl, 10)


# plotting bar chart of salaries for the players who made the 10 fewestt yards .
ggplot(bottom10_Yds_nfl, aes(x = factor(Player), y = Salary)) +
  geom_bar(stat = "identity", fill = '#56B4E9') +
  labs(title = "Average 2024 Salary of Players with 10 Fewest Yards", x = "Players with 10 Fewest Yards", y = "2024 Salary ($)") + 
  theme_minimal() +
  # making the player names angled so they fit
  theme(axis.text.x = element_text(angle=45, vjust=1.07, hjust=1)) +
  geom_text(label = bottom10_Yds_nfl$Yds, vjust = 1)

# and 10 highest yards. 
ggplot(top10_Yds_nfl, aes(x = factor(Player), y = Salary)) +
  geom_bar(stat = "identity", fill = '#56B4E9') +
  labs(title = "Average 2024 Salary of Players with 10 Highest Yards", x = "Players with 10 Highest Yards", y = "2024 Salary ($)") + 
  theme_minimal() +
  # making the player names angled so they fit
  theme(axis.text.x = element_text(angle=45, vjust=1.07, hjust=1)) +
  geom_text(label = top10_Yds_nfl$Yds, vjust = 1)

ggplot(top10_Yds_nfl, aes(x = factor(Yds), y = Salary)) +
  geom_bar(stat = "summary", fun = "mean", fill = '#56B4E9') +
  labs(title = "Average 2024 Salary of Players with 10 Highest Yards", x = "Total Yards", y = "2024 Salary ($)") + 
  theme_minimal()
```

Once again, not really sure how useful this will actually be for us.
